<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–æ–ø–æ–ª—ñ—Ç–∏—á–Ω—ñ –ü–æ–¥—ñ—ó - –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle" id="themeToggle">
        <button class="theme-btn" data-theme="light">‚òÄÔ∏è</button>
        <button class="theme-btn active" data-theme="dark">üåô</button>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <div class="app-container">
        <!-- Header with Search -->
        <header class="header">
            <div class="header-content">
                <h1 class="app-title">–ì–µ–æ–ø–æ–ª—ñ—Ç–∏—á–Ω—ñ –ü–æ–¥—ñ—ó</h1>
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ—à—É–∫ –ø–æ–¥—ñ–π...">
                    <div id="searchSuggestions" class="search-suggestions"></div>
                </div>
                <div class="header-stats">
                    <span id="totalEvents" class="stat-badge">–í—Å—å–æ–≥–æ –ø–æ–¥—ñ–π: 0</span>
                    <span id="filteredEvents" class="stat-badge">–í—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–æ: 0</span>
                    <div class="playback-mode-indicator" id="playbackIndicator">
                        <span class="indicator-dot"></span>
                        <span>Live —Ä–µ–∂–∏–º</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Sidebar - Filters & Import -->
            <aside class="sidebar left-sidebar" id="leftSidebar">

                <div class="sidebar-section">
                    <h3 class="sidebar-title">–§—ñ–ª—å—Ç—Ä–∏</h3>
                    
                    <!-- Quick Filters -->
                    <div class="quick-filters">
                        <button class="quick-filter-btn active" data-filter="all">–í—Å—ñ</button>
                        <button class="quick-filter-btn" data-filter="recent">–û—Å—Ç–∞–Ω–Ω—ñ</button>
                        <button class="quick-filter-btn" data-filter="conflicts">–ö–æ–Ω—Ñ–ª—ñ–∫—Ç–∏</button>
                        <button class="quick-filter-btn" data-filter="important">–í–∞–∂–ª–∏–≤—ñ</button>
                    </div>

                    <!-- Category Filters -->
                    <div class="filter-group">
                        <h4 class="filter-title">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –ø–æ–¥—ñ–π</h4>
                        <div id="categoryFilters" class="checkbox-group"></div>
                    </div>

                    <!-- Date Range Filter -->
                    <div class="filter-group">
                        <h4 class="filter-title">–ü–µ—Ä—ñ–æ–¥</h4>
                        <div class="date-range">
                            <input type="date" id="dateFrom" class="form-control date-input">
                            <span class="date-separator">–¥–æ</span>
                            <input type="date" id="dateTo" class="form-control date-input">
                        </div>
                    </div>

                    <!-- Region Filter -->
                    <div class="filter-group">
                        <h4 class="filter-title">–†–µ–≥—ñ–æ–Ω–∏</h4>
                        <select id="regionFilter" class="form-control">
                            <option value="">–í—Å—ñ —Ä–µ–≥—ñ–æ–Ω–∏</option>
                        </select>
                    </div>

                    <button id="clearFilters" class="btn btn--secondary btn--full-width">–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</button>
                </div>

                <!-- UI Tabs: Data Import (placed below Filters) -->
                <div class="sidebar-section" id="uiTabsSection">
                    <div class="tabs" role="tablist" aria-label="UI">
                        <button id="tabDataImport" class="tab active" role="tab" aria-selected="true" aria-controls="panelDataImport" tabindex="0">Data Import</button>
                    </div>
                    <div id="panelDataImport" class="tabpanel active" role="tabpanel" tabindex="0" aria-labelledby="tabDataImport">
                        <h3 class="sidebar-title">–Ü–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö</h3>

                        <div class="filter-group">
                            <h4 class="filter-title">–§–æ—Ä–º–∞—Ç</h4>
                            <select id="importFormat" class="form-control" aria-label="–§–æ—Ä–º–∞—Ç —ñ–º–ø–æ—Ä—Ç—É">
                                <option value="auto" selected>–ê–≤—Ç–æ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è</option>
                                <option value="csv">CSV</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <h4 class="filter-title">–ü–∞–∫–µ—Ç–Ω–∏–π —ñ–º–ø–æ—Ä—Ç (CSV/JSON)</h4>
                            <input id="importFile" class="form-control" type="file" accept=".csv,.json" aria-label="–§–∞–π–ª –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É">
                        </div>

                        <div class="filter-group">
                            <h4 class="filter-title">–§–æ—Ä–º–∞—Ç –¥–∞—Ç–∏ (CSV)</h4>
                            <select id="dateFormat" class="form-control" aria-label="–§–æ—Ä–º–∞—Ç –¥–∞—Ç–∏">
                                <option value="auto" selected>–ê–≤—Ç–æ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                <option value="YYYY-MM-DDTHH:mm:ssZ">ISO 8601</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <h4 class="filter-title">–ú–∞–ø—ñ–Ω–≥ –ø–æ–ª—ñ–≤ (CSV)</h4>
                            <div class="field-mapping" id="fieldMapping">
                                <label class="form-label" for="map-title">–ù–∞–∑–≤–∞</label>
                                <select id="map-title" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: –Ω–∞–∑–≤–∞"></select>

                                <label class="form-label" for="map-date">–î–∞—Ç–∞</label>
                                <select id="map-date" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: –¥–∞—Ç–∞"></select>

                                <label class="form-label" for="map-lat">–®–∏—Ä–æ—Ç–∞</label>
                                <select id="map-lat" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: —à–∏—Ä–æ—Ç–∞"></select>

                                <label class="form-label" for="map-lng">–î–æ–≤–≥–æ—Ç–∞</label>
                                <select id="map-lng" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: –¥–æ–≤–≥–æ—Ç–∞"></select>

                                <label class="form-label" for="map-description">–û–ø–∏—Å</label>
                                <select id="map-description" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: –æ–ø–∏—Å"></select>

                                <label class="form-label" for="map-category">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                                <select id="map-category" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: –∫–∞—Ç–µ–≥–æ—Ä—ñ—è"></select>

                                <label class="form-label" for="map-region">–†–µ–≥—ñ–æ–Ω</label>
                                <select id="map-region" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: —Ä–µ–≥—ñ–æ–Ω"></select>

                                <label class="form-label" for="map-country">–ö—Ä–∞—ó–Ω–∞</label>
                                <select id="map-country" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: –∫—Ä–∞—ó–Ω–∞"></select>

                                <label class="form-label" for="map-importance">–í–∞–∂–ª–∏–≤—ñ—Å—Ç—å</label>
                                <select id="map-importance" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: –≤–∞–∂–ª–∏–≤—ñ—Å—Ç—å"></select>

                                <label class="form-label" for="map-sources">–î–∂–µ—Ä–µ–ª–∞/–ø–æ—Å–∏–ª–∞–Ω–Ω—è</label>
                                <select id="map-sources" class="form-control" aria-label="–ú–∞–ø—ñ–Ω–≥: –¥–∂–µ—Ä–µ–ª–∞"></select>
                            </div>
                        </div>

                        <div class="filter-group">
                            <h4 class="filter-title">–î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è</h4>
                            <select id="dedupMode" class="form-control" aria-label="–†–µ–∂–∏–º –¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—ó">
                                <option value="auto" selected>–ê–≤—Ç–æ (–ø–æ—Å–∏–ª–∞–Ω–Ω—è/ID)</option>
                                <option value="title_date_coords">–ù–∞–∑–≤–∞ + –¥–∞—Ç–∞ + –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏</option>
                                <option value="off">–í–∏–º–∫–Ω–µ–Ω–æ</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <h4 class="filter-title">–†–µ–∂–∏–º —ñ–º–ø–æ—Ä—Ç—É</h4>
                            <div class="radio-group" role="radiogroup" aria-label="–†–µ–∂–∏–º —ñ–º–ø–æ—Ä—Ç—É">
                                <label><input type="radio" name="importMode" value="append" checked> –î–æ–¥–∞—Ç–∏ (append)</label>
                                <label><input type="radio" name="importMode" value="replace"> –ó–∞–º—ñ–Ω–∏—Ç–∏ (replace)</label>
                            </div>
                        </div>

                        <div class="filter-group">
                            <h4 class="filter-title">RSS –¥–∂–µ—Ä–µ–ª–∞</h4>
                            <textarea id="rssUrls" class="form-control" rows="3" placeholder="–í—Å—Ç–∞–≤—Ç–µ URL RSS (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Ä—è–¥–æ–∫)"></textarea>
                        </div>
                        <div class="filter-group">
                            <h4 class="filter-title">–ù–æ–≤–∏–Ω–Ω—ñ API (–æ–ø—Ü.)</h4>
                            <input id="newsApiKey" class="form-control" type="text" placeholder="NewsAPI –∫–ª—é—á (–∫–ª—ñ—î–Ω—Ç—Å—å–∫–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –æ–±–º–µ–∂–µ–Ω–µ CORS)">
                            <input id="newsApiQuery" class="form-control" type="text" placeholder="–ü–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç (–Ω–∞–ø—Ä., geopolitics, war)">
                        </div>
                        <div class="filter-group">
                            <h4 class="filter-title">–£—Ä—è–¥–æ–≤—ñ –∑–≤—ñ—Ç–∏ (JSON, –æ–ø—Ü.)</h4>
                            <input id="govJsonUrl" class="form-control" type="url" placeholder="URL –Ω–∞ JSON –∑–≤—ñ—Ç (open data)">
                        </div>
                        <div class="filter-group">
                            <h4 class="filter-title">CORS Proxy (–æ–ø—Ü.)</h4>
                            <input id="corsProxyUrl" class="form-control" type="url" placeholder="https://cors.isomorphic-git.org/ –∞–±–æ –≤–∞—à –ø—Ä–æ–∫—Å—ñ">
                        </div>

                        <div class="import-actions">
                            <button id="scanSourcesBtn" class="btn btn--primary btn--full-width">–°–∫–∞–Ω—É–≤–∞—Ç–∏ –¥–∂–µ—Ä–µ–ª–∞</button>
                            <button id="importBtn" class="btn btn--secondary btn--full-width" disabled>–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ</button>
                            <button id="clearImportBtn" class="btn btn--outline btn--full-width">–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥</button>
                        </div>

                        <div class="import-progress" id="importProgress" aria-live="polite">
                            <div class="progress-track">
                                <div class="progress-fill" id="importProgressFill" style="width: 0%"></div>
                            </div>
                            <div class="progress-status">
                                <span id="importStatusText">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è‚Ä¶</span>
                            </div>
                        </div>

                        <div id="importValidation" class="validation-messages" aria-live="polite"></div>

                        <div class="import-preview" id="importPreview">
                            <div class="import-preview-header">–ó–Ω–∞–π–¥–µ–Ω—ñ –ø–æ–¥—ñ—ó</div>
                            <div id="importPreviewList" class="import-preview-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Panel -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats-container">
                        <canvas id="categoryChart" class="chart-canvas"></canvas>
                        <canvas id="timelineChart" class="chart-canvas"></canvas>
                    </div>
                </div>
            </aside>

            <!-- Map Container -->
            <main class="map-container">
                <div id="map" class="map"></div>
                <div class="map-controls">
                    <div class="control-group">
                        <button id="resetView" class="btn btn--outline map-btn" title="–°–∫–∏–Ω—É—Ç–∏ –≤–∏–¥">
                            <span class="btn-icon">üè†</span>
                        </button>
                        <button id="fullscreen" class="btn btn--outline map-btn" title="–ü–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω">
                            <span class="btn-icon">‚õ∂</span>
                        </button>
                        <button id="layersToggle" class="btn btn--outline map-btn" title="–®–∞—Ä–∏">
                            <span class="btn-icon">üóÇ</span>
                        </button>
                    </div>
                    <div class="control-group">
                        <button id="heatmapToggle" class="btn btn--outline map-btn" title="–¢–µ–ø–ª–æ–≤–∞ –∫–∞—Ä—Ç–∞">
                            <span class="btn-icon">üî•</span>
                        </button>
                        <button id="connectionsToggle" class="btn btn--outline map-btn" title="–ó–≤'—è–∑–∫–∏">
                            <span class="btn-icon">üîó</span>
                        </button>
                        <button id="shareMap" class="btn btn--outline map-btn" title="–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è">
                            <span class="btn-icon">üì§</span>
                        </button>
                    </div>
                    <div class="control-group">
                        <button id="exportData" class="btn btn--outline map-btn" title="–ï–∫—Å–ø–æ—Ä—Ç">
                            <span class="btn-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <!-- Mobile Touch Controls -->
                <div class="mobile-touch-controls" id="mobileControls">
                    <div class="touch-gesture-hint">
                        <span>Pinch to zoom ‚Ä¢ Swipe to pan ‚Ä¢ Double tap to focus</span>
                    </div>
                </div>

                <!-- Map Loading Indicator -->
                <div class="map-loading" id="mapLoading">
                    <div class="loading-spinner"></div>
                    <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏...</span>
                </div>

                <!-- Zoom Label (shown during pinch/zoom) -->
                <div id="zoomLabel" class="zoom-label" aria-live="polite" aria-hidden="true"></div>
            </main>

            <!-- Right Sidebar - Event Details -->
            <aside class="sidebar right-sidebar" id="rightSidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">–î–µ—Ç–∞–ª—ñ –ø–æ–¥—ñ—ó</h3>
                    <div id="eventDetails" class="event-details">
                        <div class="no-selection">
                            <p>–û–±–µ—Ä—ñ—Ç—å –ø–æ–¥—ñ—é –Ω–∞ –∫–∞—Ä—Ç—ñ –∞–±–æ –≤ —á–∞—Å–æ–≤—ñ–π —à–∫–∞–ª—ñ –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –¥–µ—Ç–∞–ª–µ–π</p>
                        </div>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Timeline -->
        <div class="timeline-container">
            <div class="timeline-header">
                <h3 class="timeline-title">–ß–∞—Å–æ–≤–∞ —à–∫–∞–ª–∞</h3>
                <div class="timeline-controls">
                    <div class="playback-controls">
                        <button id="timelinePlay" class="btn btn--sm timeline-btn" title="–í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏">
                            <span class="play-icon">‚ñ∂</span>
                        </button>
                        <button id="timelinePause" class="btn btn--sm timeline-btn" title="–ü–∞—É–∑–∞">
                            <span class="pause-icon">‚è∏</span>
                        </button>
                        <button id="timelineReset" class="btn btn--sm timeline-btn" title="–°–∫–∏–Ω—É—Ç–∏">
                            <span class="reset-icon">‚èπ</span>
                        </button>
                    </div>
                    <div class="speed-controls">
                        <label for="playbackSpeed" class="speed-label">–®–≤–∏–¥–∫—ñ—Å—Ç—å:</label>
                        <select id="playbackSpeed" class="speed-select">
                            <option value="0.5">0.5x</option>
                            <option value="1" selected>1x</option>
                            <option value="2">2x</option>
                            <option value="5">5x</option>
                        </select>
                    </div>
                    <div class="timeline-progress">
                        <div class="progress-bar" id="timelineProgressBar">
                            <div class="progress-fill" id="timelineProgressFill"></div>
                            <div class="progress-handle" id="timelineProgressHandle"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Timeline Ready/Loading Overlay -->
            <div class="timeline-ready-overlay" id="timelineReadyOverlay" aria-live="polite" aria-hidden="true">
                <div class="loading-spinner"></div>
                <span id="timelineReadyText">–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è‚Ä¶</span>
                <button id="timelineReadyPlayBtn" class="btn btn--primary btn--sm" type="button" aria-label="–ü–æ—á–∞—Ç–∏ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è">
                    ‚ñ∂ –í—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏
                </button>
            </div>
            <div class="timeline-content">
                <div id="timeline" class="timeline"></div>
                <div class="timeline-scale" id="timelineScale"></div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
</body>
</html>